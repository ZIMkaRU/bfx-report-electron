<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="../../../bfx-report-ui/build/favicon.ico">
  <link href="../../../bfx-report-ui/build/fonts/inter.css" rel="stylesheet">
  <link href="./themes.css" rel="stylesheet">
  <link href="./loading-window.css" rel="stylesheet">
  <title>Bitfinex Reports</title>
</head>

<body class="body">
  <div class="win-control-btn">
    <div id="minBtn" class="window-btn window-btn__minimize window-btn--disabled"></div>
    <div id="closeBtn" class="window-btn window-btn__close window-btn--disabled"></div>
  </div>
  <div class="lds-roller">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
  <div class="logo">
    <img class="logo-img" src="../../../build/loader.png" alt="logo">
  </div>
  <div id="description" class="description"></div>
</body>

<script>
  window.addEventListener('load', () => {
    const rollers = document.getElementsByClassName('lds-roller')
    const descriptionElem = document.getElementById('description')
    const minBtnElem = document.getElementById('minBtn')
    const closeBtnElem = document.getElementById('closeBtn')

    minBtnElem.onclick = async () => {
      try {
        await window.bfxReportElectronApi?.minimizeStartupLoadingWindow()
      } catch (err) {
        console.error(err)
      }
    }
    closeBtnElem.onclick = async () => {
      try {
        await window.bfxReportElectronApi?.closeStartupLoadingWindow()
      } catch (err) {
        console.error(err)
      }
    }

    setTimeout(() => {
      for (const roller of rollers) {
        roller.classList.add("show-roller")
      }
    }, 2500)

    window.bfxReportElectronApi?.onStartupLoadingBtnStates((args) => {
      try {
        if (args?.shouldMinimizeBtnBeShown) {
          minBtnElem.classList.remove('window-btn--disabled')
        } else {
          minBtnElem.classList.add('window-btn--disabled')
        }
        if (args?.shouldCloseBtnBeShown) {
          closeBtnElem.classList.remove('window-btn--disabled')
        } else {
          closeBtnElem.classList.add('window-btn--disabled')
        }
      } catch (err) {
        console.debug(err)
      }
    })
    window.bfxReportElectronApi?.onStartupLoadingDescription((args) => {
      try {
        if (typeof args?.description !== 'string') {
          window.bfxReportElectronApi?.sendStartupLoadingDescriptionReady()

          return
        }

        descriptionElem.innerHTML = args.description

        descriptionElem.style.display = args.description
          ? 'block'
          : 'none'

        window.bfxReportElectronApi?.sendStartupLoadingDescriptionReady()
      } catch (err) {
        console.error(err)

        window.bfxReportElectronApi?.sendStartupLoadingDescriptionReady({ err })
      }
    })
  })
</script>
</html>
